<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Roulette Trend Tracker — FULL • CASH PRIORITY v13.7</title>
<style>
  :root{
    --bg:#071022;
    --card:#0c1a33;
    --card2:#0b1730;
    --stroke:rgba(255,255,255,.08);
    --text:#e8eefc;
    --muted:rgba(232,238,252,.65);
    --pill:rgba(255,255,255,.10);
    --btn:rgba(90,140,255,.18);
    --btnStroke:rgba(140,180,255,.25);
    --danger:rgba(255,90,90,.18);
    --dangerStroke:rgba(255,120,120,.30);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background: radial-gradient(1200px 700px at 30% 10%, #0b1b3b 0%, var(--bg) 55%, #050a16 100%);
    color:var(--text);
  }
  .wrap{max-width:980px;margin:0 auto;padding:18px 14px 60px;}
  h1{font-size:44px;letter-spacing:.2px;margin:8px 0 10px;}
  .buildpill{
    display:inline-flex;gap:10px;align-items:center;
    padding:10px 14px;border-radius:999px;
    background:rgba(255,255,255,.06);
    border:1px solid var(--stroke);
    color:var(--muted);
    font-weight:600;
  }
  .subtitle{margin:14px 0 18px;color:var(--muted);line-height:1.35}
  .grid{display:grid;grid-template-columns:1fr;gap:14px}
  @media(min-width:900px){ .grid{grid-template-columns:1.05fr .95fr;} }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border:1px solid var(--stroke);
    border-radius:18px;
    padding:16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.30);
  }
  .card h2{margin:0 0 10px;font-size:22px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .pill{display:inline-flex;gap:10px;align-items:center;padding:10px 12px;border-radius:999px;background:var(--pill);border:1px solid var(--stroke);color:var(--muted);font-weight:700}
  .pill b{color:var(--text)}
  input, textarea{
    width:100%;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid var(--stroke);
    background:rgba(0,0,0,.15);
    color:var(--text);
    outline:none;
    font-size:16px;
  }
  textarea{min-height:88px;resize:vertical}
  .btn{
    user-select:none;
    padding:12px 14px;border-radius:14px;border:1px solid var(--btnStroke);
    background:var(--btn);color:var(--text);font-weight:800;
    cursor:pointer;
  }
  .btn.danger{border-color:var(--dangerStroke);background:var(--danger)}
  .btn:active{transform:translateY(1px)}
  .kbdgrid{
    display:grid;
    grid-template-columns: repeat(6, 1fr);
    gap:10px;
    margin-top:12px;
  }
  @media(min-width:520px){ .kbdgrid{grid-template-columns: repeat(8, 1fr);} }
  .key{
    padding:10px 0;border-radius:14px;border:1px solid var(--stroke);
    background:rgba(255,255,255,.05);
    font-weight:900;
    text-align:center;
    cursor:pointer;
  }
  .key.wide{grid-column: span 2;}
  .muted{color:var(--muted)}
  .sectionTitle{margin:12px 0 8px;font-size:20px}
  .twoCols{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:700px){ .twoCols{grid-template-columns:1fr 1fr;} }
  .stat{background:rgba(0,0,0,.12);border:1px solid var(--stroke);border-radius:16px;padding:12px}
  .stat .label{color:var(--muted);font-weight:800}
  .stat .value{margin-top:8px;font-size:28px;font-weight:900;letter-spacing:.5px}
  .stat .small{margin-top:8px;color:var(--muted);font-weight:700;line-height:1.3}
  .top3{display:grid;grid-template-columns:1fr;gap:10px}
  .playcard{
    border-radius:16px;border:1px solid var(--stroke);
    background:rgba(0,0,0,.12);
    padding:12px;
  }
  .playcard .head{display:flex;justify-content:space-between;align-items:center;gap:10px}
  .badge{padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);background:rgba(255,255,255,.06);color:var(--muted);font-weight:900}
  .playcard .name{font-weight:950;font-size:18px}
  .playcard .meta{color:var(--muted);font-weight:700;margin-top:6px;line-height:1.25}
  .playcard .actions{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
  .divider{height:1px;background:var(--stroke);margin:14px 0}
  .warn{color:#ffd7a8}
</style>
</head>
<body>
<div class="wrap">
  <h1>Roulette Trend Tracker</h1>
  <div class="buildpill">Build: <b>2026-01-07</b> • <b>FULL</b> • <b>CASH PRIORITY</b> <b>v13.7</b> • Regression-fix (trend + Hydra + repeats + table-state)</div>
  <div class="subtitle">
    Tap spins on the keypad (fastest) or paste a comma list. Tracks last 10/15/20: columns, dozens, double-streets, red/black, high/low, even/odd, Junko quadrants.
    Saves on-device. American wheel (0 and 00; type <b>00</b> for double-zero).
  </div>

  <div class="grid">
    <div class="card">
      <h2>Session</h2>
      <div class="row">
        <div class="pill">Window: <b id="windowLbl">Last 15</b></div>
        <div class="pill">Spins: <b id="spinsLbl">0</b></div>
        <div class="pill">Since green: <b id="sinceGreenLbl">—</b></div>
      </div>
      <div style="margin-top:10px">
        <div class="muted" style="font-weight:800;margin-bottom:6px">Casino</div>
        <input id="casinoInp" placeholder="e.g., Caesars / Harrah's Joliet" />
      </div>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="undoBtn">Undo</button>
        <button class="btn danger" id="clearBtn">Clear</button>
        <button class="btn" id="w10Btn">Use last 10</button>
        <button class="btn" id="w15Btn">Use last 15</button>
        <button class="btn" id="w20Btn">Use last 20</button>
      </div>

      <div class="divider"></div>

      <h2>Quick input</h2>
      <div class="row" style="align-items:flex-start">
        <div style="flex:1;min-width:220px">
          <input id="quickInp" inputmode="numeric" placeholder="Type: 0–36 or 00 or comma list" />
          <div class="muted" style="margin-top:8px;font-weight:700">Tip: keypad is fastest; paste is a backup. Press Enter or tap Add.</div>
        </div>
        <button class="btn" id="addBtn" style="min-width:120px">Add</button>
      </div>

      <div class="sectionTitle">Tap keypad</div>
      <div class="kbdgrid" id="kbd"></div>

      <div class="divider"></div>

      <h2>Paste history (comma-separated)</h2>
      <textarea id="pasteBox" placeholder="Example: 16,3,00,27,9,2,10"></textarea>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="pasteBtn">Add pasted spins</button>
        <button class="btn" id="copyCsvBtn">Copy CSV</button>
      </div>
      <div class="muted" style="margin-top:10px">
        Export includes: number, casino, date, time, session_id. Import by pasting CSV into your master log.
      </div>
    </div>

    <div class="card">
      <h2>Trend + tracking</h2>
      <div class="twoCols">
        <div class="stat">
          <div class="label">Recommended play</div>
          <div class="value" id="recPlay">Sit out</div>
          <div class="small" id="recWhy">Enter at least 15 spins.</div>
        </div>
        <div class="stat">
          <div class="label">Table state</div>
          <div class="value" id="tblState">—</div>
          <div class="small" id="tblDetail">—</div>
        </div>
      </div>

      <div class="divider"></div>

      <h2>Top 3 strategies right now</h2>
      <div class="top3" id="top3"></div>

      <div class="divider"></div>

      <div class="twoCols">
        <div class="stat">
          <div class="label">Columns (C1/C2/C3)</div>
          <div class="value mono" id="colsLbl">0 / 0 / 0</div>
          <div class="small" id="colsDetail">—</div>
        </div>
        <div class="stat">
          <div class="label">Dozens (D1/D2/D3)</div>
          <div class="value mono" id="dozLbl">0 / 0 / 0</div>
          <div class="small" id="dozDetail">—</div>
        </div>
        <div class="stat">
          <div class="label">Double Streets (per dozen)</div>
          <div class="value mono" id="dsLbl">D1 — | D2 — | D3 —</div>
          <div class="small" id="dsDetail">Least-hit DS per dozen (last 15).</div>
        </div>
        <div class="stat">
          <div class="label">Red / Black</div>
          <div class="value mono" id="rbLbl">0 / 0</div>
          <div class="small" id="rbDetail">—</div>
        </div>
        <div class="stat">
          <div class="label">High / Low</div>
          <div class="value mono" id="hlLbl">0 / 0</div>
          <div class="small" id="hlDetail">—</div>
        </div>
        <div class="stat">
          <div class="label">Even / Odd</div>
          <div class="value mono" id="eoLbl">0 / 0</div>
          <div class="small" id="eoDetail">—</div>
        </div>
        <div class="stat" style="grid-column:1/-1">
          <div class="label">Junko quadrants (GN | HO | LO | M)</div>
          <div class="value mono" id="jqLbl">GN 0 | HO 0 | LO 0 | M 0</div>
          <div class="small" id="jqDetail">Last 15.</div>
        </div>
      </div>

      <div class="divider"></div>

      <h2>Hydra cold (last 15)</h2>
      <div class="twoCols">
        <div class="stat">
          <div class="label">Coldest 4 numbers</div>
          <div class="value mono" id="cold4Lbl">—</div>
          <div class="small" id="cold4Detail">Least hits in last 15 (excluding 0/00).</div>
        </div>
        <div class="stat">
          <div class="label">Repeats / streets repeating</div>
          <div class="value mono" id="repeatsLbl">—</div>
          <div class="small" id="streetsLbl">—</div>
        </div>
      </div>

      <div class="divider"></div>

      <h2>Last 20 (newest first)</h2>
      <div class="stat">
        <div class="value mono" style="font-size:16px;font-weight:800" id="last20Lbl">—</div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // ========= storage / state =========
  const STORAGE_KEY = "rt_full_v13_7_state";
  const nowISO = () => new Date().toISOString();
  const pad2 = n => String(n).padStart(2,"0");
  const fmtLocal = (d=new Date()) => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  const fmtTime = (d=new Date()) => `${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`;

  const state = {
    window: 15,
    casino: "",
    sessionId: Math.floor(Date.now()/1000),
    spins: [], // numeric; 99 represents 00
    rows: []   // export rows: {n, casino, date, time, session}
  };

  // ========= helpers =========
  const $ = id => document.getElementById(id);
  const isInt = x => Number.isInteger(x);
  const toDisplay = n => (n === 99 ? "00" : String(n));
  const parseToken = (tok) => {
    const t = String(tok).trim();
    if (!t) return null;
    if (t === "00" || t === "0,0") return 99;
    if (t === "99") return 99;
    const n = Number(t);
    if (!Number.isFinite(n)) return null;
    if (!isInt(n)) return null;
    if (n < 0 || n > 36) return null;
    return n;
  };
  const parseList = (s) => {
    return String(s).split(/[\s,]+/).map(parseToken).filter(v => v !== null);
  };

  const reds = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
  const isRed = n => (n!==0 && n!==99 && reds.has(n));
  const isBlack = n => (n!==0 && n!==99 && !reds.has(n));
  const isGreen = n => (n===0 || n===99);
  const isHigh = n => (n>=19 && n<=36);
  const isLow = n => (n>=1 && n<=18);
  const isEven = n => (n>=1 && n<=36 && n%2===0);
  const isOdd  = n => (n>=1 && n<=36 && n%2===1);
  const colOf = n => {
    if (n<1 || n>36) return 0;
    const r = n % 3;
    return r===1 ? 1 : (r===2 ? 2 : 3);
  };
  const dozOf = n => {
    if (n<1 || n>36) return 0;
    if (n<=12) return 1;
    if (n<=24) return 2;
    return 3;
  };
  const streetOf = n => {
    if (n<1 || n>36) return 0;
    return Math.floor((n-1)/3)+1; // 1..12
  };
  const dsOf = n => {
    if (n<1 || n>36) return 0;
    return Math.floor((n-1)/6)+1; // 1..6 across table (1-6,7-12,...,31-36)
  };

  // Junko quadrants (American wheel; 00=99)
  const GN = new Set([99,0,1,2,9,10,13,14,27,28]);
  const HO = new Set([24,25,26,29,30,33,34,35,36]);
  const LO = new Set([3,4,8,11,12,15,16,22,23]);
  const M  = new Set([5,6,7,17,18,19,20,21,31,32]);
  const quadOf = n => GN.has(n) ? "GN" : HO.has(n) ? "HO" : LO.has(n) ? "LO" : M.has(n) ? "M" : "—";

  const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  const load = () => {
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      const s = JSON.parse(raw);
      if (s && Array.isArray(s.spins) && Array.isArray(s.rows)) {
        state.window = [10,15,20].includes(s.window) ? s.window : 15;
        state.casino = typeof s.casino === "string" ? s.casino : "";
        state.sessionId = typeof s.sessionId === "number" ? s.sessionId : state.sessionId;
        state.spins = s.spins.filter(n => Number.isInteger(n) && (n===99 || (n>=0 && n<=36)));
        state.rows  = s.rows.filter(r => r && typeof r === "object");
      }
    }catch(e){}
  };

  const addSpin = (n) => {
    const casino = ($("casinoInp").value || "").trim();
    state.casino = casino;
    const d = new Date();
    state.spins.push(n);
    state.rows.push({ number: toDisplay(n), casino: casino || "", date: fmtLocal(d), time: fmtTime(d), session_id: state.sessionId });
    save();
    render();
  };

  const addMany = (arr) => {
    if (!arr.length) return;
    const casino = ($("casinoInp").value || "").trim();
    state.casino = casino;
    const d = new Date();
    const date = fmtLocal(d);
    const time = fmtTime(d);
    for (const n of arr){
      state.spins.push(n);
      state.rows.push({ number: toDisplay(n), casino: casino || "", date, time, session_id: state.sessionId });
    }
    save();
    render();
  };

  const undo = () => {
    state.spins.pop();
    state.rows.pop();
    save();
    render();
  };
  const clearAll = () => {
    state.spins = [];
    state.rows = [];
    state.sessionId = Math.floor(Date.now()/1000);
    save();
    render();
  };

  const windowSpins = () => {
    const w = state.window;
    return state.spins.slice(Math.max(0, state.spins.length - w));
  };

  const sinceGreen = () => {
    for (let i=state.spins.length-1, k=0; i>=0; i--, k++){
      if (isGreen(state.spins[i])) return k;
    }
    return state.spins.length ? state.spins.length : 0;
  };

  // ========= analytics =========
  const counts = (arr, pred) => arr.reduce((a,n)=>a+(pred(n)?1:0),0);
  const countMap = (arr, fnKey) => {
    const m = new Map();
    for (const n of arr){
      const k = fnKey(n);
      if (k===0 || k==="—") continue;
      m.set(k, (m.get(k)||0)+1);
    }
    return m;
  };
  const topRepeats = (arr) => {
    const m = new Map();
    for (const n of arr){
      const k = toDisplay(n);
      m.set(k,(m.get(k)||0)+1);
    }
    const rep = [...m.entries()].filter(([k,v])=>v>=2).sort((a,b)=>b[1]-a[1] || (a[0].length-b[0].length) || (a[0]>b[0]?1:-1));
    return rep.slice(0,6).map(([k,v])=>`${k}×${v}`).join("  ");
  };

  const streetRepeats = (arr) => {
    const m = new Map();
    for (const n of arr){
      const s = streetOf(n);
      if (!s) continue;
      m.set(s,(m.get(s)||0)+1);
    }
    const rep = [...m.entries()].filter(([k,v])=>v>=2).sort((a,b)=>b[1]-a[1] || a[0]-b[0]).slice(0,6);
    if (!rep.length) return "Streets: —";
    return "Streets: " + rep.map(([k,v])=>`S${k}×${v}`).join("  ");
  };

  const dsLeastPerDozen = (arr15) => {
    // For each dozen: DS within dozen => (1–6,7–12) etc. Return least-hit DS index in that dozen.
    const d1 = arr15.filter(n=>dozOf(n)===1);
    const d2 = arr15.filter(n=>dozOf(n)===2);
    const d3 = arr15.filter(n=>dozOf(n)===3);
    const dsInDozen = (dozIdx) => dozIdx===1 ? [[1,[1,6]],[2,[7,12]]] :
                        dozIdx===2 ? [[3,[13,18]],[4,[19,24]]] :
                                     [[5,[25,30]],[6,[31,36]]];
    const countRange = (arr, lo, hi) => arr.reduce((a,n)=>a+((n>=lo&&n<=hi)?1:0),0);
    const pickLeast = (dozIdx, arr) => {
      const opts = dsInDozen(dozIdx).map(([id,[lo,hi]]) => ({id, c: countRange(arr15, lo, hi)}));
      opts.sort((a,b)=>a.c-b.c || a.id-b.id);
      return opts[0];
    };
    return {
      D1: pickLeast(1,d1),
      D2: pickLeast(2,d2),
      D3: pickLeast(3,d3),
    };
  };

  const coldest4 = (arr15) => {
    const m = new Map();
    for (let n=1;n<=36;n++) m.set(n,0);
    for (const n of arr15){
      if (n>=1 && n<=36) m.set(n, m.get(n)+1);
    }
    const sorted=[...m.entries()].sort((a,b)=>a[1]-b[1] || a[0]-b[0]);
    return sorted.slice(0,4).map(([n,c])=>`${n}(${c})`).join("  ");
  };

  const tableState = (arr15) => {
    if (arr15.length < 15) return {state:"—", detail:"Need 15 spins."};
    // Metrics:
    // - concentration: max(dozens) and max(columns)
    const dozM = countMap(arr15, dozOf);
    const colM = countMap(arr15, colOf);
    const getMax = (m) => Math.max(...[...(m.values()) , 0]);
    const getMin = (m) => Math.min(...[...(m.values()) , 15]);
    const dozMax = getMax(dozM), dozMin = Math.min(dozM.get(1)||0, dozM.get(2)||0, dozM.get(3)||0);
    const colMax = getMax(colM), colMin = Math.min(colM.get(1)||0, colM.get(2)||0, colM.get(3)||0);

    // - RB switching (exclude greens)
    const rbSeq = arr15.filter(n=>!isGreen(n)).map(n=>isRed(n)?"R":"B");
    let switches=0;
    for (let i=1;i<rbSeq.length;i++) if (rbSeq[i]!==rbSeq[i-1]) switches++;

    // heuristic classification
    const strong = (dozMax>=8 || colMax>=8);
    if (strong) {
      const which = dozMax>=colMax ? `Dozen max ${dozMax}` : `Column max ${colMax}`;
      return {state:"Trendy", detail:`${which}; switches ${switches}/${Math.max(1,rbSeq.length-1)}`};
    }
    const choppy = switches >= Math.max(6, Math.floor((rbSeq.length-1)*0.70));
    if (choppy) return {state:"Choppy", detail:`R/B switches high (${switches}); distribution mixed`};
    const flat = (Math.max(dozMax-dozMin, colMax-colMin) <= 2);
    if (flat) return {state:"Flat", detail:`Balanced: Doz ${dozMax}/${dozMin}, Col ${colMax}/${colMin}`};
    return {state:"Mixed", detail:`Doz ${dozMax}/${dozMin}, Col ${colMax}/${colMin}, switches ${switches}`};
  };

  // ========= strategy scoring (top-8 rotation) =========
  const PRIORITY = [
    "Hydra v1.5B – Hybrid",
    "Hydra v1.5B – Columns",
    "Corners+DS Tight",
    "Junko 10-to-Win",
    "Moon Dance 2S/Dozen",
    "Opposite-Segment Contrarian",
    "Disappearing Streets",
    "Corners+DS (Original)"
  ];

  const scoreHydraHybrid = (arr15) => {
    if (arr15.length < 15) return {name:"Hydra v1.5B – Hybrid", score:0, how:"Warmup: observe 15 spins."};
    // mode by last-15 imbalance gap>=3 and confirm>=3 (simple)
    const col = [0,0,0]; const doz=[0,0,0];
    for (const n of arr15){ const c=colOf(n); if(c) col[c-1]++; const d=dozOf(n); if(d) doz[d-1]++; }
    const colGap = Math.max(...col)-Math.min(...col);
    const dozGap = Math.max(...doz)-Math.min(...doz);
    const mode = (Math.max(colGap,dozGap) >= 3) ? (colGap>=dozGap ? "Columns" : "Dozens") : "Columns";
    let score = 78;
    if (Math.max(colGap,dozGap) >= 3) score += 12;
    if (sinceGreen() <= 2) score -= 6; // volatility
    return {name:"Hydra v1.5B – Hybrid", score:Math.max(0, Math.min(99, score)), how:`Play Hydra Hybrid (mode: ${mode}). Run the Hydra tiers; reset on any win; do not switch mid-cycle.`};
  };

  const scoreHydraColumns = (arr15) => {
    if (arr15.length < 15) return {name:"Hydra v1.5B – Columns", score:0, how:"Warmup: observe 15 spins."};
    const col = [0,0,0];
    for (const n of arr15){ const c=colOf(n); if(c) col[c-1]++; }
    const gap = Math.max(...col)-Math.min(...col);
    let score = 74 + Math.min(18, gap*4);
    if (sinceGreen() <= 2) score -= 6;
    return {name:"Hydra v1.5B – Columns", score:Math.max(0, Math.min(99, score)), how:"Play Hydra Columns (fixed). Tier1: 2 cold columns; then DS/corners/splits/straights per your Hydra ladder. Reset on any win."};
  };

  const scoreCornersDSTight = (arr15) => {
    if (arr15.length < 15) return {name:"Corners+DS Tight", score:0, how:"Warmup: observe 15 spins."};
    const st = tableState(arr15);
    let score = 70;
    if (st.state === "Trendy") score -= 8;
    if (st.state === "Flat") score += 8;
    if (sinceGreen() >= 6) score += 6;
    return {name:"Corners+DS Tight", score:Math.max(0, Math.min(99, score)), how:"Use Corners+DS Tight. Lock DS; corners are recovery-only after 3 DS misses; follow your u progression and green hedge ramp."};
  };

  const scoreJunko10 = (arr15) => {
    if (arr15.length < 15) return {name:"Junko 10-to-Win", score:0, how:"Warmup: observe 15 spins."};
    // Gate uses last 8 spins: drought exists + balance among non-zero <=1
    const last8 = state.spins.slice(-8);
    if (last8.length < 8) return {name:"Junko 10-to-Win", score:0, how:"Need last 8 spins."};
    const c = {GN:0,HO:0,LO:0,M:0};
    for (const n of last8) c[quadOf(n)] = (c[quadOf(n)]||0)+1;
    const countsNZ = Object.entries(c).filter(([k,v])=>v>0).map(([k,v])=>v);
    const drought = Object.values(c).some(v=>v===0);
    const balance = countsNZ.length ? (Math.max(...countsNZ)-Math.min(...countsNZ) <= 1) : false;
    let score = 60;
    if (drought && balance) score = 90;
    else if (drought) score = 78;
    const missing = Object.entries(c).filter(([k,v])=>v===0).map(([k])=>k)[0] || "—";
    return {name:"Junko 10-to-Win", score, how:`If gated: bet the missing quadrant (${missing}) using u=1,1,2,3,5 then +1 per extra miss; remove hit numbers and reset u.`};
  };

  const scoreMoonDance = (arr15) => {
    if (arr15.length < 15) return {name:"Moon Dance 2S/Dozen", score:0, how:"Warmup: observe 15 spins."};
    // Select 2 least-hit streets in each dozen (6 streets total)
    let score = 76;
    const st = tableState(arr15);
    if (st.state === "Choppy") score += 8;
    if (st.state === "Trendy") score -= 6;
    return {name:"Moon Dance 2S/Dozen", score:Math.max(0, Math.min(99, score)), how:"Compute 2 least-hit streets per dozen (last 15). Bet the 18 numbers straight-up at b=1; double b on a full miss; reset b on any hit or 0/00; add 0/00 hedge only when b>=8."};
  };

  const scoreOppSeg = (arr15) => {
    if (arr15.length < 15) return {name:"Opposite-Segment Contrarian", score:0, how:"Warmup: observe 15 spins."};
    // activation threshold: hottest segment >=6 in last15 (we approximate by Junko quadrants as segments)
    const q = {GN:0,HO:0,LO:0,M:0};
    for (const n of arr15) q[quadOf(n)] = (q[quadOf(n)]||0)+1;
    const hottest = Object.entries(q).sort((a,b)=>b[1]-a[1] || ["GN","HO","LO","M"].indexOf(a[0]) - ["GN","HO","LO","M"].indexOf(b[0]))[0];
    let score = 62;
    if (hottest[1] >= 6) score = 88;
    return {name:"Opposite-Segment Contrarian", score, how:"If hottest segment >=6 in last 15: start cycle betting the opposite segment at $1/number; escalate +1u after 3 consecutive misses; stop at +100 or -200 guardrail."};
  };

  const scoreDisappearing = (arr15) => ({name:"Disappearing Streets", score:55, how:"Comp builder / situational. Use only when you explicitly choose it."});
  const scoreCornersDSOriginal = (arr15) => ({name:"Corners+DS (Original)", score:40, how:"Removed from active rotation."});

  const scoreAll = (arr15) => {
    const scored = [
      scoreHydraHybrid(arr15),
      scoreHydraColumns(arr15),
      scoreCornersDSTight(arr15),
      scoreJunko10(arr15),
      scoreMoonDance(arr15),
      scoreOppSeg(arr15),
      scoreDisappearing(arr15),
      scoreCornersDSOriginal(arr15),
    ].map(x => ({...x, score: Math.round(x.score)}));

    // Sort by score desc, then priority order when >=85
    const prIdx = (name) => PRIORITY.indexOf(name) === -1 ? 999 : PRIORITY.indexOf(name);
    scored.sort((a,b)=>{
      if (b.score !== a.score) return b.score - a.score;
      // if multiple >=85, prioritize
      if (a.score >= 85 && b.score >= 85) return prIdx(a.name) - prIdx(b.name);
      return prIdx(a.name) - prIdx(b.name);
    });
    return scored;
  };

  // ========= render =========
  const renderTop3 = (arr15) => {
    const host = $("top3");
    host.innerHTML = "";
    if (arr15.length < 15){
      host.innerHTML = `<div class="playcard"><div class="name">Warmup</div><div class="meta">Enter at least 15 spins to see strategy rankings.</div></div>`;
      return;
    }
    const all = scoreAll(arr15);
    const top = all.slice(0,3);
    for (const s of top){
      const div = document.createElement("div");
      div.className = "playcard";
      div.innerHTML = `
        <div class="head">
          <div class="name">${s.name}</div>
          <div class="badge">${s.score}</div>
        </div>
        <div class="meta">${s.score >= 85 ? "Qualified" : "Watch"} • Use your session rules (+100 / -300 w/ guardrail).</div>
        <div class="actions">
          <button class="btn" data-explain="${encodeURIComponent(s.name)}">Explain</button>
        </div>
      `;
      host.appendChild(div);
    }
    host.querySelectorAll("button[data-explain]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const name = decodeURIComponent(btn.getAttribute("data-explain"));
        const all = scoreAll(arr15);
        const s = all.find(x=>x.name===name);
        if(!s) return;
        const msg = `${name}\n\nHOW TO PLAY:\n${s.how}`;
        alert(msg);
      });
    });
  };

  const render = () => {
    $("casinoInp").value = state.casino || "";
    $("windowLbl").textContent = `Last ${state.window}`;
    $("spinsLbl").textContent = String(state.spins.length);
    $("sinceGreenLbl").textContent = state.spins.length ? String(sinceGreen()) : "—";

    const arrW = windowSpins();
    const arr15 = state.spins.slice(-15);
    const last20 = state.spins.slice(-20).reverse().map(toDisplay).join(", ");
    $("last20Lbl").textContent = last20 || "—";

    // core counts (use last15)
    const col = [0,0,0], doz=[0,0,0];
    let red=0, black=0, high=0, low=0, even=0, odd=0;
    const jq = {GN:0,HO:0,LO:0,M:0};
    for (const n of arr15){
      const c=colOf(n); if(c) col[c-1]++;
      const d=dozOf(n); if(d) doz[d-1]++;
      if (isRed(n)) red++;
      if (isBlack(n)) black++;
      if (isHigh(n)) high++;
      if (isLow(n)) low++;
      if (isEven(n)) even++;
      if (isOdd(n)) odd++;
      const q=quadOf(n); if (jq[q]!==undefined) jq[q]++;
    }

    $("colsLbl").textContent = `${col[0]} / ${col[1]} / ${col[2]}`;
    $("dozLbl").textContent  = `${doz[0]} / ${doz[1]} / ${doz[2]}`;
    $("rbLbl").textContent   = `${red} / ${black}`;
    $("hlLbl").textContent   = `${high} / ${low}`;
    $("eoLbl").textContent   = `${even} / ${odd}`;
    $("jqLbl").textContent   = `GN ${jq.GN} | HO ${jq.HO} | LO ${jq.LO} | M ${jq.M}`;

    // DS least per dozen
    const ds = dsLeastPerDozen(arr15);
    $("dsLbl").textContent = `D1 ${ds.D1.c}/${ds.D1.id===1?ds.D1.c:ds.D1.c}  |  D2 ${ds.D2.c}/${ds.D2.id===3?ds.D2.c:ds.D2.c}  |  D3 ${ds.D3.c}/${ds.D3.id===5?ds.D3.c:ds.D3.c}`;
    $("dsDetail").textContent = `Least-hit DS: D1 ${ds.D1.id===1?"1–6":"7–12"} (${ds.D1.c}) • D2 ${ds.D2.id===3?"13–18":"19–24"} (${ds.D2.c}) • D3 ${ds.D3.id===5?"25–30":"31–36"} (${ds.D3.c})`;

    // table state
    const ts = tableState(arr15);
    $("tblState").textContent = ts.state;
    $("tblDetail").textContent = ts.detail;

    // repeats + streets repeating (last20)
    const last20Arr = state.spins.slice(-20);
    $("repeatsLbl").textContent = topRepeats(last20Arr) || "—";
    $("streetsLbl").textContent = streetRepeats(last20Arr);

    // cold4 (last15)
    $("cold4Lbl").textContent = arr15.length ? coldest4(arr15) : "—";
    $("cold4Detail").textContent = arr15.length<15 ? "Need 15 spins." : "Least hits in last 15 (excluding 0/00).";

    // top3 + recommended play
    renderTop3(arr15);
    if (arr15.length < 15){
      $("recPlay").textContent = "Sit out";
      $("recWhy").textContent = "Enter at least 15 spins.";
    } else {
      const all = scoreAll(arr15);
      const best = all[0];
      $("recPlay").textContent = (best.score >= 85) ? best.name : "Sit out";
      $("recWhy").textContent = (best.score >= 85) ? "Top score ≥ 85 (priority applied)." : "No strategy ≥ 85.";
    }
  };

  // ========= UI wiring =========
  const buildKeypad = () => {
    const kbd = $("kbd");
    const keys = [];
    for (let i=1;i<=36;i++) keys.push(String(i));
    keys.unshift("0"); keys.unshift("00");
    // layout: 00,0,1..36
    for (const k of keys){
      const b = document.createElement("div");
      b.className = "key";
      b.textContent = k;
      b.addEventListener("click", ()=> {
        const n = parseToken(k);
        if (n===null) return;
        addSpin(n);
      });
      kbd.appendChild(b);
    }
  };

  const handleAdd = () => {
    const s = $("quickInp").value;
    const list = parseList(s);
    if (!list.length) return;
    if (list.length === 1) addSpin(list[0]);
    else addMany(list);
    $("quickInp").value = "";
  };

  const copyCSV = async () => {
    const header = "number,casino,date,time,session_id";
    const lines = state.rows.map(r => `${r.number},"${(r.casino||"").replaceAll('"','""')}",${r.date},${r.time},${r.session_id}`);
    const csv = [header, ...lines].join("\n");
    try{
      await navigator.clipboard.writeText(csv);
      alert("CSV copied to clipboard.");
    }catch(e){
      // fallback
      const ta = document.createElement("textarea");
      ta.value = csv;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      alert("CSV copied (fallback).");
    }
  };

  // init
  load();
  buildKeypad();
  $("casinoInp").addEventListener("input", ()=>{ state.casino = $("casinoInp").value; save(); });
  $("addBtn").addEventListener("click", handleAdd);
  $("quickInp").addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); handleAdd(); }});
  $("pasteBtn").addEventListener("click", ()=>{
    const list = parseList($("pasteBox").value);
    addMany(list);
    $("pasteBox").value = "";
  });
  $("copyCsvBtn").addEventListener("click", copyCSV);

  $("undoBtn").addEventListener("click", undo);
  $("clearBtn").addEventListener("click", clearAll);

  $("w10Btn").addEventListener("click", ()=>{ state.window=10; save(); render(); });
  $("w15Btn").addEventListener("click", ()=>{ state.window=15; save(); render(); });
  $("w20Btn").addEventListener("click", ()=>{ state.window=20; save(); render(); });

  render();
})();
</script>
</body>
</html>
